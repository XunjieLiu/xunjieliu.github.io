<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"xunjieliu.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Golang code review&#x2F;best practice notesNotes after reading Go Code Review Comments from Golang github repository wiki  This page collects common comments made during reviews of Go code, so that a singl">
<meta property="og:type" content="article">
<meta property="og:title" content="Golang code review&#x2F;best practice notes">
<meta property="og:url" content="https://xunjieliu.github.io/2021/11/Golang-code-review-best-practice-notes/index.html">
<meta property="og:site_name" content="Xunjie">
<meta property="og:description" content="Golang code review&#x2F;best practice notesNotes after reading Go Code Review Comments from Golang github repository wiki  This page collects common comments made during reviews of Go code, so that a singl">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-11-10T09:35:05.000Z">
<meta property="article:modified_time" content="2021-11-10T09:36:35.464Z">
<meta property="article:author" content="Xunjie Liu">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://xunjieliu.github.io/2021/11/Golang-code-review-best-practice-notes/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Golang code review/best practice notes | Xunjie</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Xunjie</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://xunjieliu.github.io/2021/11/Golang-code-review-best-practice-notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Xunjie Liu">
      <meta itemprop="description" content="This description is for test">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xunjie">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Golang code review/best practice notes
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-11-10 17:35:05 / Modified: 17:36:35" itemprop="dateCreated datePublished" datetime="2021-11-10T17:35:05+08:00">2021-11-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Golang-code-review-best-practice-notes"><a href="#Golang-code-review-best-practice-notes" class="headerlink" title="Golang code review/best practice notes"></a>Golang code review/best practice notes</h1><p>Notes after reading <a target="_blank" rel="noopener" href="https://github.com/golang/go/wiki/CodeReviewComments">Go Code Review Comments</a> from Golang github repository wiki</p>
<blockquote>
<p>This page collects common comments made during reviews of Go code, so that a single detailed explanation can be referred to by shorthands. This is a laundry list of common mistakes, not a comprehensive style guide.</p>
</blockquote>
<p><strong>Common mistakes, not a style guide</strong></p>
<span id="more"></span>

<h2 id="Name"><a href="#Name" class="headerlink" title="Name"></a>Name</h2><h3 id="Package-names"><a href="#Package-names" class="headerlink" title="Package names"></a>Package names</h3><p>Lower case , single-word names, no underscores or mixedCaps</p>
<p>No worry about collisions, the import packages could be renamed locally</p>
<p>The importer of a package will use the name to refer to its contents, so exported names in the package can use that fact to avoid repetition.</p>
<h3 id="Getters"><a href="#Getters" class="headerlink" title="Getters"></a>Getters</h3><p>It’s neither idiomatic nor necessary to put <code>Get</code> into the getter’s name. </p>
<p>If you have a field called <code>owner</code> (lower case, unexported), the getter method should be called <code>Owner</code> (upper case, exported), not <code>GetOwner</code>. </p>
<p>A setter function, if needed, will likely be called <code>SetOwner</code>. Both names read well in practice:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">owner := obj.Owner()</span><br><span class="line"><span class="keyword">if</span> owner != user &#123;</span><br><span class="line">    obj.SetOwner(user)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Interfaces"><a href="#Interfaces" class="headerlink" title="Interfaces"></a>Interfaces</h3><p>Go interfaces generally belong in the package that uses values of the interface type, not the package that implements those values.</p>
<p>Do not define interfaces on the implementor side of an API “for mocking”; instead, design the API so that it can be tested using the public API of the real implementation.</p>
<p>Do not define interfaces before they are used: without a realistic example of usage, it is too difficult to see whether an interface is even necessary, let alone what methods it ought to contain.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> consumer  <span class="comment">// consumer.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Thinger <span class="keyword">interface</span> &#123; Thing() <span class="keyword">bool</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Foo</span><span class="params">(t Thinger)</span> <span class="title">string</span></span> &#123; … &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> consumer <span class="comment">// consumer_test.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> fakeThinger <span class="keyword">struct</span>&#123; … &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t fakeThinger)</span> <span class="title">Thing</span><span class="params">()</span> <span class="title">bool</span></span> &#123; … &#125;</span><br><span class="line">…</span><br><span class="line"><span class="keyword">if</span> Foo(fakeThinger&#123;…&#125;) == <span class="string">&quot;x&quot;</span> &#123; … &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DO NOT DO IT!!!</span></span><br><span class="line"><span class="keyword">package</span> producer</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Thinger <span class="keyword">interface</span> &#123; Thing() <span class="keyword">bool</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> defaultThinger <span class="keyword">struct</span>&#123; … &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t defaultThinger)</span> <span class="title">Thing</span><span class="params">()</span> <span class="title">bool</span></span> &#123; … &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewThinger</span><span class="params">()</span> <span class="title">Thinger</span></span> &#123; <span class="keyword">return</span> defaultThinger&#123; … &#125; &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Mixed-Caps"><a href="#Mixed-Caps" class="headerlink" title="Mixed Caps"></a>Mixed Caps</h3><p>The convention in Go is to use <code>MixedCaps</code> or <code>mixedCaps</code> rather than underscores to write multiword names.</p>
<h3 id="Receiver-Names"><a href="#Receiver-Names" class="headerlink" title="Receiver Names"></a>Receiver Names</h3><p>The name of a method’s receiver should be a reflection of its identity; often a one or two letter abbreviation of its type suffices (such as “c” or “cl” for “Client”).</p>
<p>The name need not be as descriptive as that of a method argument, as its role is obvious and serves no documentary purpose.</p>
<h3 id="Variable-Names"><a href="#Variable-Names" class="headerlink" title="Variable Names"></a>Variable Names</h3><p>Variable names in Go should be short rather than long. This is especially true for local variables with limited scope. Prefer <code>c</code> to <code>lineCount</code>. Prefer <code>i</code> to <code>sliceIndex</code>.</p>
<p>The basic rule: the further from its declaration that a name is used, the more descriptive the name must be. For a method receiver, one or two letters is sufficient. Common variables such as loop indices and readers can be a single letter (<code>i</code>, <code>r</code>). More unusual things and global variables need more descriptive names.</p>
<h2 id="Gofmt"><a href="#Gofmt" class="headerlink" title="Gofmt"></a>Gofmt</h2><p><code>gofmt</code> is a go command to format <code>.go</code> files</p>
<ul>
<li><p>In terminal, under project folder</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gofmt -s -w .</span><br></pre></td></tr></table></figure></li>
<li><p>In <code>Goland</code>, go to <code>Settings</code>, find <code>File Watchers</code>, add <code>go fmt</code></p>
</li>
</ul>
<h2 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h2><p>Comments declarations should be full sentences, they would be extracted into godoc documentation.</p>
<p>Comments should begin with the name of the thing being described.</p>
<p>Block comments appears mostly as package comments.</p>
<h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><blockquote>
<p>Context like a timeout or deadline or a channel to indicate stop working and return.</p>
</blockquote>
<p>Most functions that use a Context should accept it as their first parameter:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">F</span><span class="params">(ctx context.Context, /* other arguments */)</span></span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>A function that is never request-specific may use <code>context.Background()</code>, but err on the side of passing a Context even if you think you don’t need to.</p>
<p>The default case is to pass a Context; only use <code>context.Background()</code> directly if you have a good reason.</p>
<p>Don’t add a Context member to a struct type; instead add a <code>ctx</code> parameter to each method on that type that needs to pass it along.</p>
<p>Don’t create custom Context types or use interfaces other than Context in function signatures.</p>
<p>If you have application data to pass around, put it in a parameter, in the receiver, in globals, or, <strong>if it truly belongs there, in a Context value.</strong></p>
<h2 id="Copying"><a href="#Copying" class="headerlink" title="Copying"></a>Copying</h2><p>Be careful when copying a struct from another package.</p>
<p>In general, do not copy a value of type <code>T</code> if its methods are associated with the pointer type, <code>*T</code>.</p>
<h2 id="Crypto-Rand"><a href="#Crypto-Rand" class="headerlink" title="Crypto Rand"></a>Crypto Rand</h2><p>Do not use package <code>math/rand</code> to generate keys, even throwaway ones.</p>
<p>Instead, use <code>crypto/rand</code>‘s Reader, and if you need text, print to hexadecimal or base64:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;crypto/rand&quot;</span></span><br><span class="line">	<span class="comment">// &quot;encoding/base64&quot;</span></span><br><span class="line">	<span class="comment">// &quot;encoding/hex&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Key</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	buf := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">16</span>)</span><br><span class="line">	_, err := rand.Read(buf)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)  <span class="comment">// out of randomness, should never happen</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%x&quot;</span>, buf)</span><br><span class="line">	<span class="comment">// or hex.EncodeToString(buf)</span></span><br><span class="line">	<span class="comment">// or base64.StdEncoding.EncodeToString(buf)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Declaring-Empty-Slices"><a href="#Declaring-Empty-Slices" class="headerlink" title="Declaring Empty Slices"></a>Declaring Empty Slices</h2><p>Prefer</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> t []<span class="keyword">string</span> <span class="comment">// nil slice value</span></span><br></pre></td></tr></table></figure>

<p>Rather than</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t := []<span class="keyword">string</span>&#123;&#125; <span class="comment">// non-nil but zero-length</span></span><br></pre></td></tr></table></figure>

<p>Note that there are limited circumstances where a non-nil but zero-length slice is preferred, such as when encoding JSON objects (a <code>nil</code> slice encodes to <code>null</code>, while <code>[]string&#123;&#125;</code> encodes to the JSON array <code>[]</code>).</p>
<p>When designing interfaces, avoid making a distinction between a nil slice and a non-nil, zero-length slice, as this can lead to subtle programming errors.</p>
<blockquote>
<p>For more discussion about nil in Go see Francesc Campoy’s talk <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=ynoY2xz-F8s">Understanding Nil</a>.</p>
</blockquote>
<h2 id="Doc-Comments"><a href="#Doc-Comments" class="headerlink" title="Doc Comments"></a>Doc Comments</h2><p>All top-level, exported names should have doc comments</p>
<h2 id="Don’t-Panic"><a href="#Don’t-Panic" class="headerlink" title="Don’t Panic"></a>Don’t Panic</h2><p>Don’t use panic for normal error handling. Use error and multiple return values.</p>
<p>Go’s multi-value return makes it easy to return a detailed error description alongside the normal return value. It is good style to use this feature to provide detailed error information.</p>
<p>Don’t just return nil if fails, return nil and an error for more information.</p>
<p>When feasible, error strings should identify their origin, such as by having a prefix naming the operation or package that generated the error. </p>
<p>Callers that care about the precise error details can use a type switch or a type assertion to look for specific errors and extract details.</p>
<p>If the error is unrecoverable, panic.</p>
<p>When <code>panic</code> is called:</p>
<ul>
<li>it immediately stops execution of the current function</li>
<li>begins unwinding the stack of the goroutine</li>
<li>running any deferred functions along the way</li>
<li><code>recover</code> is only useful inside deferred functions.</li>
</ul>
<h2 id="Error-Strings"><a href="#Error-Strings" class="headerlink" title="Error Strings"></a>Error Strings</h2><p>Error strings should not be capitalized (unless beginning with proper nouns or acronyms)</p>
<p>Error strings should not end with punctuation.</p>
<p>Use <code>fmt.Errorf(&quot;something bad&quot;)</code>, not <code>fmt.Errorf(&quot;Something bad&quot;)</code></p>
<h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><p>When adding a new package, include examples of intended usage: a runnable Example, or a simple test demonstrating a complete call sequence.</p>
<h2 id="Goroutine-Lifetimes"><a href="#Goroutine-Lifetimes" class="headerlink" title="Goroutine Lifetimes"></a>Goroutine Lifetimes</h2><p>Make it clear when your new goroutines when or whether they exit.</p>
<p><strong>Goroutines can leak</strong> by blocking on channel sends or receives: the garbage collector will not terminate a goroutine even if the channels it is blocked on are unreachable.</p>
<p>Even when goroutines do not leak, <strong>leaving them in-flight when they are no longer needed</strong> can cause other subtle and hard-to-diagnose problems.</p>
<p>Try to keep concurrent code simple enough that goroutine lifetimes are obvious.</p>
<h2 id="Handle-Errors"><a href="#Handle-Errors" class="headerlink" title="Handle Errors"></a>Handle Errors</h2><p>Do not discard errors using <code>_</code> variables.</p>
<p>Handle the error, return it, or, in truly exceptional situations, panic.</p>
<p>Check <a target="_blank" rel="noopener" href="https://golang.org/doc/effective_go#errors">Effective Go</a></p>
<h2 id="Imports"><a href="#Imports" class="headerlink" title="Imports"></a>Imports</h2><p>Avoid renaming imports except to avoid a name collision.</p>
<p>In the event of collision, prefer to rename the most local or project-specific import.</p>
<p>Imports are organized in groups, with blank lines between them. The standard library packages are always in the first group.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;hash/adler32&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;appengine/foo&quot;</span></span><br><span class="line">	<span class="string">&quot;appengine/user&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/foo/bar&quot;</span></span><br><span class="line">	<span class="string">&quot;rsc.io/goversion/version&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>Try to use <code>goimports</code></p>
<h2 id="Import-Blank"><a href="#Import-Blank" class="headerlink" title="Import Blank"></a>Import Blank</h2><p>Packages that are imported only for their side effects (using the syntax <code>import _ &quot;pkg&quot;</code>) should only be imported in the main package of a program, or in tests that require them.</p>
<h2 id="Import-Dot"><a href="#Import-Dot" class="headerlink" title="Import Dot"></a>Import Dot</h2><p>The import <code>.</code> could be useful in tests when, due to circular dependencies, cannot be made part of the package being tested:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> foo_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;bar/testutil&quot;</span> <span class="comment">// also imports &quot;foo&quot;</span></span><br><span class="line">	. <span class="string">&quot;foo&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="In-Band-Errors"><a href="#In-Band-Errors" class="headerlink" title="In-Band Errors"></a>In-Band Errors</h2><p>A function should return an additional value to indicate whether its other return values are valid.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Lookup returns the value for key or ok=false if there is no mapping for key.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Lookup</span><span class="params">(key <span class="keyword">string</span>)</span> <span class="params">(value <span class="keyword">string</span>, ok <span class="keyword">bool</span>)</span></span></span><br></pre></td></tr></table></figure>

<p>And encourages more robust and readable code:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">value, ok := Lookup(key)</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line">	<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;no value for %q&quot;</span>, key)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> Parse(value)</span><br></pre></td></tr></table></figure>

<p>Return values like nil, “”, 0, and -1 are fine when they are valid results for a function, that is, when the caller need not handle them differently from other values.</p>
<p>Some standard library functions, like those in package “strings”, return in-band error values.</p>
<h2 id="Indent-Error-Flow"><a href="#Indent-Error-Flow" class="headerlink" title="Indent Error Flow"></a>Indent Error Flow</h2><p>Try to keep the normal code path at a minimal indentation, and indent the error handling</p>
<h2 id="Initialisms"><a href="#Initialisms" class="headerlink" title="Initialisms"></a>Initialisms</h2><p>Words in names that are initialisms or acronyms (e.g. “URL” or “NATO”) have a consistent case.</p>
<p><code>URL</code> or <code>url</code>, do not use <code>Url</code></p>
<p><code>ServeHTTP</code> not <code>ServeHttp</code>. For identifiers with multiple initialized “words”, use for example <code>xmlHTTPRequest</code> or <code>XMLHTTPRequest</code>.</p>
<p>This rule also applies to “ID” when it is short for “identifier” (which is pretty much all cases when it’s not the “id” as in “ego”, “superego”), so write <code>appID</code> instead of <code>appId</code>.</p>
<p>Code generated by the protocol buffer compiler is exempt from this rule.</p>
<h2 id="Named-Result-Parameters"><a href="#Named-Result-Parameters" class="headerlink" title="Named Result Parameters"></a>Named Result Parameters</h2><p>Consider what it will look like in godoc. Named result parameters like:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n *Node)</span> <span class="title">Parent1</span><span class="params">()</span> <span class="params">(node *Node)</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n *Node)</span> <span class="title">Parent2</span><span class="params">()</span> <span class="params">(node *Node, err error)</span></span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>will be repetitive in godoc; better to use:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n *Node)</span> <span class="title">Parent1</span><span class="params">()</span> *<span class="title">Node</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n *Node)</span> <span class="title">Parent2</span><span class="params">()</span> <span class="params">(*Node, error)</span></span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>On the other hand, if a function returns two or three parameters of the same type, or if the meaning of a result isn’t clear from context, adding names may be useful in some contexts.</p>
<p>Once it’s a medium sized function, be explicit with your return values.</p>
<h2 id="Pass-Values"><a href="#Pass-Values" class="headerlink" title="Pass Values"></a>Pass Values</h2><p>Don’t pass pointers as function arguments just to save a few bytes.</p>
<p>Common instances of this include passing a pointer to a string (<code>*string</code>) or a pointer to an interface value (<code>*io.Reader</code>). In both cases the value itself is a fixed size and can be passed directly.</p>
<p>This advice does not apply to large structs, or even small structs that might grow.</p>
<h2 id="Receiver-Type"><a href="#Receiver-Type" class="headerlink" title="Receiver Type"></a>Receiver Type</h2><p>Choosing whether to use a value or pointer receiver on methods can be difficult, especially to new Go programmers. If in doubt, use a pointer, but there are times when a value receiver makes sense, usually for reasons of efficiency, such as for small unchanging structs or values of basic type. Some useful guidelines:</p>
<ul>
<li>If the receiver is a <strong>map, func or chan</strong>, don’t use a pointer to them. If the receiver is a slice and the method doesn’t reslice or reallocate the slice, don’t use a pointer to it.</li>
<li>If the method needs to <strong>mutate</strong> the receiver, the receiver must be a pointer.</li>
<li>If the receiver is a struct that contains a sync.Mutex or similar synchronizing field, the receiver must be a pointer to avoid copying.</li>
<li>If the receiver is a large struct or array, a pointer receiver is more efficient. How large is large? Assume it’s equivalent to passing all its elements as arguments to the method. If that feels too large, it’s also too large for the receiver.</li>
<li>Can function or methods, either concurrently or when called from this method, be mutating the receiver? A value type creates a copy of the receiver when the method is invoked, so outside updates will not be applied to this receiver. If changes must be visible in the original receiver, the receiver must be a pointer.</li>
<li>If the receiver is a struct, array or slice and any of its elements is a pointer to something that might be mutating, prefer a pointer receiver, as it will make the intention clearer to the reader.</li>
<li>If the receiver is a small array or struct that is naturally a value type (for instance, something like the time.Time type), with no mutable fields and no pointers, or is just a simple basic type such as int or string, a value receiver makes sense. A value receiver can reduce the amount of garbage that can be generated; if a value is passed to a value method, an on-stack copy can be used instead of allocating on the heap. (The compiler tries to be smart about avoiding this allocation, but it can’t always succeed.) Don’t choose a value receiver type for this reason without profiling first.</li>
<li>Don’t mix receiver types. Choose either pointers or struct types for all available methods.</li>
<li>Finally, when in doubt, use a pointer receiver.</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/11/Ubuntu-installation-guideline/" rel="prev" title="Ubuntu installation guideline">
      <i class="fa fa-chevron-left"></i> Ubuntu installation guideline
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/11/Go-mod-notes/" rel="next" title="Go mod notes">
      Go mod notes <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Golang-code-review-best-practice-notes"><span class="nav-number">1.</span> <span class="nav-text">Golang code review&#x2F;best practice notes</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Name"><span class="nav-number">1.1.</span> <span class="nav-text">Name</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Package-names"><span class="nav-number">1.1.1.</span> <span class="nav-text">Package names</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Getters"><span class="nav-number">1.1.2.</span> <span class="nav-text">Getters</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Interfaces"><span class="nav-number">1.1.3.</span> <span class="nav-text">Interfaces</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mixed-Caps"><span class="nav-number">1.1.4.</span> <span class="nav-text">Mixed Caps</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Receiver-Names"><span class="nav-number">1.1.5.</span> <span class="nav-text">Receiver Names</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Variable-Names"><span class="nav-number">1.1.6.</span> <span class="nav-text">Variable Names</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gofmt"><span class="nav-number">1.2.</span> <span class="nav-text">Gofmt</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Comments"><span class="nav-number">1.3.</span> <span class="nav-text">Comments</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Context"><span class="nav-number">1.4.</span> <span class="nav-text">Context</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Copying"><span class="nav-number">1.5.</span> <span class="nav-text">Copying</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Crypto-Rand"><span class="nav-number">1.6.</span> <span class="nav-text">Crypto Rand</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Declaring-Empty-Slices"><span class="nav-number">1.7.</span> <span class="nav-text">Declaring Empty Slices</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Doc-Comments"><span class="nav-number">1.8.</span> <span class="nav-text">Doc Comments</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Don%E2%80%99t-Panic"><span class="nav-number">1.9.</span> <span class="nav-text">Don’t Panic</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Error-Strings"><span class="nav-number">1.10.</span> <span class="nav-text">Error Strings</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Examples"><span class="nav-number">1.11.</span> <span class="nav-text">Examples</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Goroutine-Lifetimes"><span class="nav-number">1.12.</span> <span class="nav-text">Goroutine Lifetimes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Handle-Errors"><span class="nav-number">1.13.</span> <span class="nav-text">Handle Errors</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Imports"><span class="nav-number">1.14.</span> <span class="nav-text">Imports</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Import-Blank"><span class="nav-number">1.15.</span> <span class="nav-text">Import Blank</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Import-Dot"><span class="nav-number">1.16.</span> <span class="nav-text">Import Dot</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#In-Band-Errors"><span class="nav-number">1.17.</span> <span class="nav-text">In-Band Errors</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Indent-Error-Flow"><span class="nav-number">1.18.</span> <span class="nav-text">Indent Error Flow</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Initialisms"><span class="nav-number">1.19.</span> <span class="nav-text">Initialisms</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Named-Result-Parameters"><span class="nav-number">1.20.</span> <span class="nav-text">Named Result Parameters</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pass-Values"><span class="nav-number">1.21.</span> <span class="nav-text">Pass Values</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Receiver-Type"><span class="nav-number">1.22.</span> <span class="nav-text">Receiver Type</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Xunjie Liu</p>
  <div class="site-description" itemprop="description">This description is for test</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/XunjieLiu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;XunjieLiu" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:xunjieliu97@gmail.com" title="E-Mail → mailto:xunjieliu97@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Xunjie Liu</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
